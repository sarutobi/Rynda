language: python
python:
  - "3.7.3"
# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
install: "pip install -r requirements/travis.txt"
# # command to run tests, e.g. python setup.py test
services:
  - postgresql

addons:
    apt:
      sources:
        - sourceline: "ppa:ubuntugis/ubuntugis-unstable"
      packages:
        - postgresql-11
        - postgresql-11-postgis-2.5
        - postgresql-11-postgis-2.5-scripts

before_script:
    - sudo apt-get update
    - sudo apt-get install libgdal-dev
    - sudo sed -i 's/port = 5433/port = 5432/' /etc/postgresql/11/main/postgresql.conf
    - sudo cp /etc/postgresql/{10,11}/main/pg_hba.conf
    - sudo service postgresql stop
    - sudo service postgresql start 11 
    - psql -c 'create database rynda;' -U postgres
    - psql -c 'create extension postgis' -U postgres -d rynda
    - python manage.py migrate --settings=rynda.Rynda.settings.travis

script:
  - python manage.py test --settings=rynda.Rynda.settings.travis

